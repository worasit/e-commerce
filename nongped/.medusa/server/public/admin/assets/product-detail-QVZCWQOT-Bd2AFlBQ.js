import{g as Q}from"./chunk-OIAPXGI2-D0wb1bhE.js";import{S as u}from"./chunk-LFLGEXIG-DjrJjFFv.js";import{T as z}from"./chunk-2RQLKDBF-DdHfvUFV.js";import{P as L}from"./chunk-P3UUX2T6-iZ3txzdJ.js";import{u as R,D as J}from"./chunk-W34HOKLZ-C3c-DWJt.js";import{Q as E,j as e,q as Y,d as H,R as U,a as k,S as G,p as Z,s as X,b as h,H as g,A as f,u as ee,f as te,r as S,U as se,m as M,V as q,L as O,T as b,B as ae,W as V,Y as A,J as ie,Z as ne,_ as le,k as re,$ as oe,a0 as ce}from"./index-CJZ0utKv.js";import"./lodash-r6m_RtXk.js";import{u as de}from"./chunk-C76H5USB-BpSyh2up.js";import"./chunk-VDP2AG2T-lTWCWF6Z.js";import"./chunk-KHOKHZC6-CwL1LPjm.js";import{P as C}from"./chunk-PV6FYEYE-D-2ojrbf.js";import{P as v}from"./pencil-square-CANgz5Uf.js";import{S as ue}from"./status-badge-K2cHY97K.js";import{T as B}from"./trash-Dbmfz9SX.js";import{T as me}from"./thumbnail-badge-DbgOXRqm.js";import{C as xe}from"./channels-9NXhnbKC.js";import{T as pe}from"./Trans-CyKh6hGN.js";import{C as K}from"./component-CUX8KuAP.js";import{u as T}from"./use-prompt-Bi7FceQH.js";import{C as y}from"./container-CvrRqui1.js";import{C as he}from"./checkbox-C144Yjdp.js";import{C as w}from"./command-bar-DKNd8HCa.js";import{c as fe}from"./index-B1m4_RH3.js";import"./x-mark-mini-ysYOSGAt.js";import"./chunk-YEDAFXMB-CRa1E9kp.js";import"./chunk-AOFGTNG6-Do1n8oDW.js";import"./chunk-WX2SMNCD-gsBa7lx4.js";import"./plus-mini-BdX2C9J6.js";import"./chunk-HG5TSG3K-BtN5fyyg.js";import"./format-B_KHsbPT.js";import"./date-picker-Celg6WpL.js";import"./clsx-B-dksMZM.js";import"./popover-Dq5pafWl.js";import"./index-poKGl5ZU.js";import"./triangle-left-mini-DJxp3gb4.js";import"./prompt-Di3JszOJ.js";var ht=t=>{const{id:s}=t.params||{},{product:i}=E(s,{fields:C},{initialData:t.data,enabled:!!s});return i?e.jsx("span",{children:i.title}):null},ve=t=>({queryKey:Z.detail(t,{fields:C}),queryFn:async()=>X.admin.product.retrieve(t,{fields:C})}),ft=async({params:t})=>{const s=t.id,i=ve(s);return await Y.ensureQueryData({...i,staleTime:9e4})},je=({product:t})=>{const{t:s}=h(),{getDisplays:i}=k();return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{level:"h2",children:s("products.attributes")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"attributes",icon:e.jsx(v,{})}]}]})]}),e.jsx(u,{title:s("fields.height"),value:t.height}),e.jsx(u,{title:s("fields.width"),value:t.width}),e.jsx(u,{title:s("fields.length"),value:t.length}),e.jsx(u,{title:s("fields.weight"),value:t.weight}),e.jsx(u,{title:s("fields.midCode"),value:t.mid_code}),e.jsx(u,{title:s("fields.hsCode"),value:t.hs_code}),e.jsx(u,{title:s("fields.countryOfOrigin"),value:Q(t.origin_country)}),i("product","attributes").map((a,l)=>e.jsx(a,{data:t},l))]})},ge=t=>{switch(t){case"draft":return"grey";case"proposed":return"orange";case"published":return"green";case"rejected":return"red";default:return"grey"}},ye=({product:t})=>{const{t:s}=h(),i=T(),a=ee(),{getDisplays:l}=k(),n=l("product","general"),{mutateAsync:o}=te(t.id),c=async()=>{await i({title:s("general.areYouSure"),description:s("products.deleteWarning",{title:t.title}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")})&&await o(void 0,{onSuccess:()=>{a("..")}})};return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{children:t.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(ue,{color:ge(t.status),children:s(`products.productStatus.${t.status}`)}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"edit",icon:e.jsx(v,{})}]},{actions:[{label:s("actions.delete"),onClick:c,icon:e.jsx(B,{})}]}]})]})]}),e.jsx(u,{title:s("fields.description"),value:t.description}),e.jsx(u,{title:s("fields.subtitle"),value:t.subtitle}),e.jsx(u,{title:s("fields.handle"),value:`/${t.handle}`}),e.jsx(u,{title:s("fields.discountable"),value:t.discountable?s("fields.true"):s("fields.false")}),n.map((m,r)=>e.jsx(m,{data:t},r))]})},be=({product:t})=>{const{t:s}=h(),i=T(),[a,l]=S.useState({}),n=we(t),o=r=>{l(d=>{if(d[r]){const{[r]:x,...p}=d;return p}else return{...d,[r]:!0}})},{mutateAsync:c}=se(t.id),m=async()=>{const r=Object.keys(a),d=r.some(j=>{var P;return(P=n.find(D=>D.id===j))==null?void 0:P.isThumbnail});if(!await i({title:s("general.areYouSure"),description:d?s("products.media.deleteWarningWithThumbnail",{count:r.length}):s("products.media.deleteWarning",{count:r.length}),confirmText:s("actions.delete"),cancelText:s("actions.cancel")}))return;const p=t.images.filter(j=>!r.includes(j.id)).map(j=>({url:j.url}));await c({images:p,thumbnail:d?"":void 0},{onSuccess:()=>{l({})}})};return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{level:"h2",children:s("products.media.label")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"media?view=edit",icon:e.jsx(v,{})}]}]})]}),n.length>0?e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-4 px-6 py-4",children:n.map((r,d)=>{const x=a[r.id];return e.jsxs("div",{className:"shadow-elevation-card-rest hover:shadow-elevation-card-hover transition-fg group relative aspect-square size-full cursor-pointer overflow-hidden rounded-[8px]",children:[e.jsx("div",{className:M("transition-fg invisible absolute right-2 top-2 opacity-0 group-hover:visible group-hover:opacity-100",{"visible opacity-100":x}),children:e.jsx(he,{checked:a[r.id]||!1,onCheckedChange:()=>o(r.id)})}),r.isThumbnail&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(q,{content:s("fields.thumbnail"),children:e.jsx(me,{})})}),e.jsx(O,{to:"media",state:{curr:d},children:e.jsx("img",{src:r.url,alt:`${t.title} image`,className:"size-full object-cover"})})]},r.id)})}):e.jsxs("div",{className:"flex flex-col items-center gap-y-4 pb-8 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(b,{size:"small",leading:"compact",weight:"plus",className:"text-ui-fg-subtle",children:s("products.media.emptyState.header")}),e.jsx(b,{size:"small",className:"text-ui-fg-muted",children:s("products.media.emptyState.description")})]}),e.jsx(ae,{size:"small",variant:"secondary",asChild:!0,children:e.jsx(O,{to:"media?view=edit",children:s("products.media.emptyState.action")})})]}),e.jsx(w,{open:!!Object.keys(a).length,children:e.jsxs(w.Bar,{children:[e.jsx(w.Value,{children:s("general.countSelected",{count:Object.keys(a).length})}),e.jsx(w.Seperator,{}),e.jsx(w.Command,{action:m,label:s("actions.delete"),shortcut:"d"})]})})]})},we=t=>{const{images:s=[],thumbnail:i}=t,a=s.map(l=>({id:l.id,url:l.url,isThumbnail:l.url===i}));return i&&!a.some(l=>l.url===i)&&a.unshift({id:"img_thumbnail",url:i,isThumbnail:!0}),a},Ne=({product:t,option:s})=>{const{t:i}=h(),{mutateAsync:a}=le(t.id,s.id),l=T(),n=async()=>{await l({title:i("general.areYouSure"),description:i("products.options.deleteWarning",{title:s.title}),confirmText:i("actions.delete"),cancelText:i("actions.cancel")})&&await a()};return e.jsx(f,{groups:[{actions:[{label:i("actions.edit"),to:`options/${s.id}/edit`,icon:e.jsx(v,{})}]},{actions:[{label:i("actions.delete"),onClick:n,icon:e.jsx(B,{})}]}]})},_e=({product:t})=>{var i;const{t:s}=h();return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{level:"h2",children:s("products.options.header")}),e.jsx(f,{groups:[{actions:[{label:s("actions.create"),to:"options/create",icon:e.jsx(V,{})}]}]})]}),(i=t.options)==null?void 0:i.map(a=>{var l;return e.jsx(u,{title:a.title,value:(l=a.values)==null?void 0:l.map(n=>e.jsx(A,{size:"2xsmall",className:"flex min-w-[20px] items-center justify-center",children:n.value},n.value)),actions:e.jsx(Ne,{product:t,option:a})},a.id)})]})},Se=({product:t})=>{var a,l;const{t:s}=h(),{getDisplays:i}=k();return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{level:"h2",children:s("products.organization.header")}),e.jsx(f,{groups:[{actions:[{label:s("actions.edit"),to:"organization",icon:e.jsx(v,{})}]}]})]}),e.jsx(u,{title:s("fields.tags"),value:(a=t.tags)!=null&&a.length?t.tags.map(n=>e.jsx(_,{label:n.value,to:`/settings/product-tags/${n.id}`},n.id)):void 0}),e.jsx(u,{title:s("fields.type"),value:t.type?e.jsx(_,{label:t.type.value,to:`/settings/product-types/${t.type_id}`}):void 0}),e.jsx(u,{title:s("fields.collection"),value:t.collection?e.jsx(_,{label:t.collection.title,to:`/collections/${t.collection.id}`}):void 0}),e.jsx(u,{title:s("fields.categories"),value:(l=t.categories)!=null&&l.length?t.categories.map(n=>e.jsx(_,{label:n.name,to:`/categories/${n.id}`},n.id)):void 0}),i("product","organize").map((n,o)=>e.jsx(n,{data:t},o))]})},_=({label:t,to:s})=>e.jsx(q,{content:t,children:e.jsx(A,{size:"2xsmall",className:"block w-fit truncate",asChild:!0,children:e.jsx(O,{to:s,children:t})})}),Ce=({product:t})=>{var o;const{count:s}=ie(),{t:i}=h(),a=((o=t.sales_channels)==null?void 0:o.map(c=>({id:c.id,name:c.name})))??[],l=a.slice(0,3),n=a.slice(3);return e.jsxs(y,{className:"flex flex-col gap-y-4 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{level:"h2",children:i("fields.sales_channels")}),e.jsx(f,{groups:[{actions:[{label:i("actions.edit"),to:"sales-channels",icon:e.jsx(v,{})}]}]})]}),e.jsxs("div",{className:"grid grid-cols-[28px_1fr] items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base shadow-borders-base flex size-7 items-center justify-center rounded-md",children:e.jsx("div",{className:"bg-ui-bg-component flex size-6 items-center justify-center rounded-[4px]",children:e.jsx(xe,{className:"text-ui-fg-subtle"})})}),a.length>0?e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(b,{size:"small",leading:"compact",children:l.map(c=>c.name).join(", ")}),n.length>0&&e.jsx(q,{content:e.jsx("ul",{children:n.map(c=>e.jsx("li",{children:c.name},c.id))}),children:e.jsx(b,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:`+${n.length}`})})]}):e.jsx(b,{size:"small",leading:"compact",className:"text-ui-fg-subtle",children:i("products.noSalesChannels")})]}),e.jsx("div",{children:e.jsx(b,{className:"text-ui-fg-subtle",size:"small",leading:"compact",children:e.jsx(pe,{i18nKey:"sales_channels.availableIn",values:{x:a.length,y:s??0},components:[e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"x"),e.jsx("span",{className:"text-ui-fg-base txt-compact-medium-plus"},"y")]})})})]})},ke=({variant:t,product:s})=>{var x;const{mutateAsync:i}=oe(s.id,t.id),{t:a}=h(),l=T(),n=((x=t.inventory_items)==null?void 0:x.length)||0,o=n===1,c=n>1,m=async()=>{await l({title:a("general.areYouSure"),description:a("products.deleteVariantWarning",{title:t.title}),confirmText:a("actions.delete"),cancelText:a("actions.cancel")})&&await i()},[r,d]=S.useMemo(()=>{var $;if(!(($=t.inventory_items)!=null&&$.length))return["",""];const j=`/inventory/${t.inventory_items[0].inventory.id}`,D={id:t.inventory_items.map(F=>F.inventory.id)},W=`/inventory?${new URLSearchParams(D).toString()}`;return[j,W]},[t.inventory_items]);return e.jsx(f,{groups:[{actions:[{label:a("actions.edit"),to:`edit-variant?variant_id=${t.id}`,icon:e.jsx(v,{})},{label:a("actions.delete"),onClick:m,icon:e.jsx(B,{})},o?{label:a("products.variant.inventory.actions.inventoryItems"),to:r,icon:e.jsx(ce,{})}:!1,c?{label:a("products.variant.inventory.actions.inventoryKit"),to:d,icon:e.jsx(K,{})}:!1].filter(Boolean)}]})},N=fe(),Te=t=>{const{t:s}=h(),i=S.useMemo(()=>t!=null&&t.options?t.options.map(a=>N.display({id:a.id,header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:a.title})}),cell:({row:l})=>{var o;const n=(o=l.original.options)==null?void 0:o.find(c=>c.option_id===a.id);return n?e.jsx("div",{className:"flex items-center",children:e.jsx(A,{size:"2xsmall",title:n.value,className:"inline-flex min-w-[20px] max-w-[140px] items-center justify-center overflow-hidden truncate",children:n.value})}):e.jsx(L,{})}})):[],[t]);return S.useMemo(()=>[N.accessor("title",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.title")})}),cell:({getValue:a})=>e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:a()})})}),N.accessor("sku",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.sku")})}),cell:({getValue:a})=>{const l=a();return l?e.jsx("div",{className:"flex h-full w-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:l})}):e.jsx(L,{})}}),...i,N.accessor("inventory_items",{header:()=>e.jsx("div",{className:"flex h-full w-full items-center",children:e.jsx("span",{className:"truncate",children:s("fields.inventory")})}),cell:({getValue:a,row:l})=>{const n=l.original;if(!n.manage_inventory)return s("products.variant.inventory.notManaged");const o=a().map(x=>x.inventory),c=o.length>1,m={};o.forEach(x=>{x.location_levels.forEach(p=>{m[p.id]=!0})});const r=Object.keys(m).length,d=c?s("products.variant.tableItemAvailable",{availableCount:n.inventory_quantity}):s("products.variant.tableItem",{availableCount:n.inventory_quantity,locationCount:r,count:r});return e.jsxs("div",{className:"flex h-full w-full items-center gap-2 overflow-hidden",children:[c&&e.jsx(K,{style:{marginTop:1}}),e.jsx("span",{className:M("truncate",{"text-ui-fg-error":!n.inventory_quantity}),title:d,children:d})]})}}),N.display({id:"actions",cell:({row:a,table:l})=>{const{product:n}=l.options.meta;return e.jsx(ke,{variant:a.original,product:n})}})],[s,i])},Pe=()=>{const{t}=h();let s=[];const i={key:"manage_inventory",label:t("fields.managedInventory"),type:"select",options:[{label:t("fields.true"),value:"true"},{label:t("fields.false"),value:"false"}]},a={key:"allow_backorder",label:t("fields.allowBackorder"),type:"select",options:[{label:t("fields.true"),value:"true"},{label:t("fields.false"),value:"false"}]},l=[{label:t("fields.createdAt"),key:"created_at"},{label:t("fields.updatedAt"),key:"updated_at"}].map(n=>({key:n.key,label:n.label,type:"date"}));return s=[...s,i,a,...l],s},De=({pageSize:t,prefix:s})=>{const i=de(["offset","q","manage_inventory","allow_backorder","order","created_at","updated_at"],s),{offset:a,manage_inventory:l,allow_backorder:n,created_at:o,updated_at:c,q:m,order:r}=i;return{searchParams:{limit:t,offset:a?Number(a):0,manage_inventory:l?l==="true":void 0,allow_backorder:n?n==="true":void 0,order:r,created_at:o?JSON.parse(o):void 0,updated_at:c?JSON.parse(c):void 0,q:m},raw:i}},I=10,ze=({product:t})=>{const{t:s}=h(),{searchParams:i,raw:a}=De({pageSize:I}),{variants:l,count:n,isLoading:o,isError:c,error:m}=ne(t.id,{...i,fields:"*inventory_items.inventory.location_levels,+inventory_quantity"},{placeholderData:re}),r=Pe(),d=Te(t),{table:x}=R({data:l??[],columns:d,count:n,enablePagination:!0,getRowId:p=>p.id,pageSize:I,meta:{product:t}});if(c)throw m;return e.jsxs(y,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(g,{level:"h2",children:s("products.variants")}),e.jsx(f,{groups:[{actions:[{label:s("actions.create"),to:"variants/create",icon:e.jsx(V,{})},{label:s("products.editPrices"),to:"prices",icon:e.jsx(v,{})}]}]})]}),e.jsx(J,{table:x,columns:d,filters:r,count:n,pageSize:I,isLoading:o,orderBy:[{key:"title",label:s("fields.title")},{key:"created_at",label:s("fields.createdAt")},{key:"updated_at",label:s("fields.updatedAt")}],navigateTo:p=>`/products/${p.original.product_id}/variants/${p.id}`,pagination:!0,search:!0,queryObject:a})]})},vt=()=>{const t=H(),{id:s}=U(),{product:i,isLoading:a,isError:l,error:n}=E(s,{fields:C},{initialData:t}),{getWidgets:o}=k(),c=o("product.details.after"),m=o("product.details.before"),r=o("product.details.side.after"),d=o("product.details.side.before");if(a||!i)return e.jsx(G,{mainSections:4,sidebarSections:3,showJSON:!0,showMetadata:!0});if(l)throw n;return e.jsxs(z,{widgets:{after:c,before:m,sideAfter:r,sideBefore:d},showJSON:!0,showMetadata:!0,data:i,children:[e.jsxs(z.Main,{children:[e.jsx(ye,{product:i}),e.jsx(be,{product:i}),e.jsx(_e,{product:i}),e.jsx(ze,{product:i})]}),e.jsxs(z.Sidebar,{children:[e.jsx(Ce,{product:i}),e.jsx(Se,{product:i}),e.jsx(je,{product:i})]})]})};export{ht as Breadcrumb,vt as Component,ft as loader};
