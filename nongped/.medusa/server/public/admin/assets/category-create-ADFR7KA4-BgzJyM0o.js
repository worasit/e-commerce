import{i as R}from"./chunk-54IEHX46-DWMq7yL7.js";import{C as B}from"./chunk-ZCYHMOTT-i1QYON1L.js";import{H as A}from"./chunk-7OYLCEKK-CNDlOgw5.js";import{a5 as c,a6 as K,j as e,b as P,r as p,a8 as $,a9 as W,ay as Y,t as M,B as E,H as q,T as G,w as s,x as J,ag as O,v as V,Y as Q}from"./index-CJZ0utKv.js";import{K as U}from"./chunk-6HTZNHPT-DAtm5oB_.js";import{R as x,u as X}from"./chunk-KL22UNUW-BusAggzY.js";import{P as g}from"./progress-tabs-xF6bypyH.js";import{T as Z}from"./textarea-CySGJxgJ.js";import{S as n}from"./select-D6d_583H.js";import"./sortable.esm-BpoPRfbd.js";import"./dots-six-LZonuE6Q.js";import"./folder-illustration-CIrEteBd.js";import"./prompt-Di3JszOJ.js";import"./triangles-mini-CxMQ-XTT.js";var ee=({form:t})=>{const{t:r}=P();return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsxs("div",{children:[e.jsx(q,{children:r("categories.create.header")}),e.jsx(G,{size:"small",className:"text-ui-fg-subtle",children:r("categories.create.hint")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"name",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("fields.title")}),e.jsx(s.Control,{children:e.jsx(J,{autoComplete:"off",...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"handle",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,tooltip:r("collections.handleTooltip"),children:r("fields.handle")}),e.jsx(s.Control,{children:e.jsx(A,{...a})}),e.jsx(s.ErrorMessage,{})]})})]}),e.jsx(s.Field,{control:t.control,name:"description",render:({field:a})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{optional:!0,children:r("fields.description")}),e.jsx(s.Control,{children:e.jsx(Z,{...a})}),e.jsx(s.ErrorMessage,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(s.Field,{control:t.control,name:"status",render:({field:{ref:a,onChange:o,...d}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("categories.fields.status.label")}),e.jsx(s.Control,{children:e.jsxs(n,{...d,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"active",children:r("categories.fields.status.active")}),e.jsx(n.Item,{value:"inactive",children:r("categories.fields.status.inactive")})]})]})}),e.jsx(s.ErrorMessage,{})]})}),e.jsx(s.Field,{control:t.control,name:"visibility",render:({field:{ref:a,onChange:o,...d}})=>e.jsxs(s.Item,{children:[e.jsx(s.Label,{children:r("categories.fields.visibility.label")}),e.jsx(s.Control,{children:e.jsxs(n,{...d,onValueChange:o,children:[e.jsx(n.Trigger,{ref:a,children:e.jsx(n.Value,{})}),e.jsxs(n.Content,{children:[e.jsx(n.Item,{value:"public",children:r("categories.fields.visibility.public")}),e.jsx(n.Item,{value:"internal",children:r("categories.fields.visibility.internal")})]})]})}),e.jsx(s.ErrorMessage,{})]})})]})]})})},D="new-item",se=({form:t,shouldFreeze:r})=>{const{t:a}=P(),[o,d]=p.useState([]),{product_categories:h,isPending:C,isError:_,error:v}=O({parent_category_id:"null",limit:9999,fields:"id,name,parent_category_id,rank,category_children,rank",include_descendants_tree:!0}),i=V({control:t.control,name:"parent_category_id"}),j=V({control:t.control,name:"rank"}),f=V({control:t.control,name:"name"}),w=p.useMemo(()=>R(h??[],{id:D,name:f,parent_category_id:i,rank:j,category_children:null}),[h,f,i,j]),N=({parentId:l,index:y},b)=>{t.setValue("parent_category_id",l,{shouldDirty:!0,shouldTouch:!0}),t.setValue("rank",y,{shouldDirty:!0,shouldTouch:!0}),d(b)};if(_)throw v;const S=!C&&!!h;return e.jsx(B,{value:r?o:w,enableDrag:l=>l.id===D,onChange:N,renderValue:l=>l.id===D?e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("span",{children:l.name}),e.jsx(Q,{size:"2xsmall",color:"blue",children:a("categories.fields.new.label")})]}):l.name,isLoading:!S})},H=c.object({name:c.string().min(1),description:c.string().optional(),handle:c.string().optional(),status:c.enum(["active","inactive"]),visibility:c.enum(["public","internal"])}),re=c.object({rank:c.number().nullable(),parent_category_id:c.string().nullable()}).merge(H),te=({parentCategoryId:t})=>{var y,b;const{t:r}=P(),{handleSuccess:a}=X(),[o,d]=p.useState("details"),[h,C]=p.useState(!1),[_,v]=p.useState(!1),i=$({defaultValues:{name:"",description:"",handle:"",status:"active",visibility:"public",rank:t?0:null,parent_category_id:t},resolver:W(re)}),j=m=>{if(m==="organize"){const{name:T,handle:z,description:F,status:I,visibility:k}=i.getValues(),u=H.safeParse({name:T,handle:z,description:F,status:I,visibility:k});if(!u.success){u.error.errors.forEach(L=>{i.setError(L.path.join("."),{type:"manual",message:L.message})});return}i.clearErrors(),C(!0)}d(m)},{mutateAsync:f,isPending:w}=Y(),N=i.handleSubmit(m=>{const{visibility:T,status:z,parent_category_id:F,rank:I,...k}=m;v(!0),f({...k,parent_category_id:F??void 0,rank:I??void 0,is_active:z==="active",is_internal:T==="internal"},{onSuccess:({product_category:u})=>{M.success(r("categories.create.successToast",{name:u.name})),a(`/categories/${u.id}`)},onError:u=>{M.error(u.message),v(!1)}})}),S=(y=i.getFieldState("parent_category_id"))!=null&&y.isDirty||(b=i.getFieldState("rank"))!=null&&b.isDirty||o==="organize"?"in-progress":"not-started",l=h?"completed":"in-progress";return e.jsx(x.Form,{form:i,children:e.jsx(U,{onSubmit:N,className:"flex size-full flex-col overflow-hidden",children:e.jsxs(g,{value:o,onValueChange:m=>j(m),className:"flex size-full flex-col",children:[e.jsx(x.Header,{children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"-my-2 w-full max-w-[400px] border-l",children:e.jsxs(g.List,{className:"grid w-full grid-cols-2",children:[e.jsx(g.Trigger,{value:"details",status:l,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:r("categories.create.tabs.details")})}),e.jsx(g.Trigger,{value:"organize",status:S,className:"w-full min-w-0 overflow-hidden",children:e.jsx("span",{className:"truncate",children:r("categories.create.tabs.organize")})})]})})})}),e.jsxs(x.Body,{className:"flex size-full flex-col overflow-auto",children:[e.jsx(g.Content,{value:"details",children:e.jsx(ee,{form:i})}),e.jsx(g.Content,{value:"organize",className:"bg-ui-bg-subtle flex-1",children:e.jsx(se,{form:i,shouldFreeze:_})})]}),e.jsx(x.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(x.Close,{asChild:!0,children:e.jsx(E,{size:"small",variant:"secondary",children:r("actions.cancel")})}),o==="organize"?e.jsx(E,{size:"small",variant:"primary",type:"submit",isLoading:w,children:r("actions.save")},"submit-btn"):e.jsx(E,{size:"small",variant:"primary",type:"button",onClick:()=>j("organize"),children:r("actions.continue")},"continue-btn")]})})]})})})},ve=()=>{const[t]=K(),r=t.get("parent_category_id");return e.jsx(x,{children:e.jsx(te,{parentCategoryId:r})})};export{ve as Component};
