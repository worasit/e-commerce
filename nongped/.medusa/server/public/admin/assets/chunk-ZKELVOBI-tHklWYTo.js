import{r as n,a5 as x,j as l,m as N,b as k,H as J,a8 as q,a9 as Q,t as P,y as X,cH as Z,w as p,b5 as u,I as ee,G as ae,B as R,aF as _}from"./index-CJZ0utKv.js";import{K as re}from"./chunk-6HTZNHPT-DAtm5oB_.js";import{b as m,u as te}from"./chunk-KL22UNUW-BusAggzY.js";import{T as le}from"./trash-Dbmfz9SX.js";var se=Object.defineProperty,h=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,I=(e,a,r)=>a in e?se(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,ie=(e,a)=>{for(var r in a||(a={}))C.call(a,r)&&I(e,r,a[r]);if(h)for(var r of h(a))F.call(a,r)&&I(e,r,a[r]);return e},ne=(e,a)=>{var r={};for(var t in e)C.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&h)for(var t of h(e))a.indexOf(t)<0&&F.call(e,t)&&(r[t]=e[t]);return r};const T=n.forwardRef((e,a)=>{var r=e,{color:t="currentColor"}=r,i=ne(r,["color"]);return n.createElement("svg",ie({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:a},i),n.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 13.056V1.944M11.278 9.278 7.5 13.056 3.722 9.278"}))});T.displayName="ArrowDownMini";var oe=Object.defineProperty,b=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,M=(e,a,r)=>a in e?oe(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,de=(e,a)=>{for(var r in a||(a={}))D.call(a,r)&&M(e,r,a[r]);if(b)for(var r of b(a))V.call(a,r)&&M(e,r,a[r]);return e},ce=(e,a)=>{var r={};for(var t in e)D.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&b)for(var t of b(e))a.indexOf(t)<0&&V.call(e,t)&&(r[t]=e[t]);return r};const L=n.forwardRef((e,a)=>{var r=e,{color:t="currentColor"}=r,i=ce(r,["color"]);return n.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:a},i),n.createElement("path",{stroke:t,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7.5 1.944v11.112M3.722 5.722 7.5 1.944l3.778 3.778"}))});L.displayName="ArrowUpMini";var me=Object.defineProperty,g=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,A=(e,a,r)=>a in e?me(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,fe=(e,a)=>{for(var r in a||(a={}))B.call(a,r)&&A(e,r,a[r]);if(g)for(var r of g(a))H.call(a,r)&&A(e,r,a[r]);return e},ue=(e,a)=>{var r={};for(var t in e)B.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&g)for(var t of g(e))a.indexOf(t)<0&&H.call(e,t)&&(r[t]=e[t]);return r};const U=n.forwardRef((e,a)=>{var r=e,{color:t="currentColor"}=r,i=ue(r,["color"]);return n.createElement("svg",fe({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:a},i),n.createElement("path",{fill:t,fillRule:"evenodd",d:"M6.306 7.5a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 2.389a1.194 1.194 0 1 1 2.389 0 1.194 1.194 0 0 1-2.39 0M6.306 12.611a1.194 1.194 0 1 1 2.388 0 1.194 1.194 0 0 1-2.388 0",clipRule:"evenodd"}))});U.displayName="EllipsisVertical";var pe=x.object({key:x.string(),disabled:x.boolean().optional(),value:x.any()}),xe=x.object({metadata:x.array(pe)}),Oe=e=>{const{t:a}=k(),{isPending:r,...t}=e;return l.jsxs(m,{children:[l.jsxs(m.Header,{children:[l.jsx(m.Title,{asChild:!0,children:l.jsx(J,{children:a("metadata.edit.header")})}),l.jsx(m.Description,{className:"sr-only",children:a("metadata.edit.description")})]}),r?l.jsx(he,{}):l.jsx(ve,{...t})]})},S="metadata-form-key-label",$="metadata-form-value-label",ve=({metadata:e,hook:a,isMutating:r})=>{const{t}=k(),{handleSuccess:i}=te();n.useRef([]);const o=je(e),s=q({defaultValues:{metadata:be(e)},resolver:Q(xe)}),j=s.handleSubmit(async d=>{const c=ge(d);await a({metadata:c},{onSuccess:()=>{P.success(t("metadata.edit.successToast")),i()},onError:f=>{P.error(f.message)}})}),{fields:v,insert:K,remove:G}=X({control:s.control,name:"metadata"});function W(d){G(d)}function E(d,c){K(d+(c==="above"?0:1),{key:"",value:"",disabled:!1})}return l.jsx(m.Form,{form:s,children:l.jsxs(re,{onSubmit:j,className:"flex flex-1 flex-col overflow-hidden",children:[l.jsxs(m.Body,{className:"flex flex-1 flex-col gap-y-8 overflow-y-auto",children:[l.jsxs("div",{className:"bg-ui-bg-base shadow-elevation-card-rest grid grid-cols-1 divide-y rounded-lg",children:[l.jsxs("div",{className:"bg-ui-bg-subtle grid grid-cols-2 divide-x rounded-t-lg",children:[l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:S,children:t("metadata.edit.labels.key")})}),l.jsx("div",{className:"txt-compact-small-plus text-ui-fg-subtle px-2 py-1.5",children:l.jsx("label",{id:$,children:t("metadata.edit.labels.value")})})]}),v.map((d,c)=>{const f=d.disabled||!1;let w="-";return typeof d.value=="object"&&(w="{ ... }"),Array.isArray(d.value)&&(w="[ ... ]"),l.jsx(Z,{showTooltip:f,content:t("metadata.edit.complexRow.tooltip"),children:l.jsxs("div",{className:"group/table relative",children:[l.jsxs("div",{className:N("grid grid-cols-2 divide-x",{"overflow-hidden rounded-b-lg":c===v.length-1}),children:[l.jsx(p.Field,{control:s.control,name:`metadata.${c}.key`,render:({field:y})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":S,...y,disabled:f,placeholder:"Key"})})})}),l.jsx(p.Field,{control:s.control,name:`metadata.${c}.value`,render:({field:{value:y,...Y}})=>l.jsx(p.Item,{children:l.jsx(p.Control,{children:l.jsx(O,{"aria-labelledby":$,...Y,value:f?w:y,disabled:f,placeholder:"Value"})})})})]}),l.jsxs(u,{children:[l.jsx(u.Trigger,{className:N("invisible absolute inset-y-0 -right-2.5 my-auto group-hover/table:visible data-[state='open']:visible",{hidden:f}),disabled:f,asChild:!0,children:l.jsx(ee,{size:"2xsmall",children:l.jsx(U,{})})}),l.jsxs(u.Content,{children:[l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(c,"above"),children:[l.jsx(L,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowAbove")]}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>E(c,"below"),children:[l.jsx(T,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.insertRowBelow")]}),l.jsx(u.Separator,{}),l.jsxs(u.Item,{className:"gap-x-2",onClick:()=>W(c),children:[l.jsx(le,{className:"text-ui-fg-subtle"}),t("metadata.edit.actions.deleteRow")]})]})]})]})},d.id)})]}),o&&l.jsx(ae,{variant:"warning",label:t("metadata.edit.complexRow.label"),children:t("metadata.edit.complexRow.description")})]}),l.jsx(m.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(m.Close,{asChild:!0,children:l.jsx(R,{size:"small",variant:"secondary",type:"button",disabled:r,children:t("actions.cancel")})}),l.jsx(R,{size:"small",type:"submit",isLoading:r,children:t("actions.save")})]})})]})})},O=n.forwardRef(({className:e,...a},r)=>l.jsx("input",{ref:r,...a,autoComplete:"off",className:N("txt-compact-small text-ui-fg-base placeholder:text-ui-fg-muted disabled:text-ui-fg-disabled disabled:bg-ui-bg-base bg-transparent px-2 py-1.5 outline-none",e)}));O.displayName="MetadataForm.GridInput";var he=()=>l.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[l.jsx(m.Body,{children:l.jsx(_,{className:"h-[148ox] w-full rounded-lg"})}),l.jsx(m.Footer,{children:l.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[l.jsx(_,{className:"h-7 w-12 rounded-md"}),l.jsx(_,{className:"h-7 w-12 rounded-md"})]})})]}),z=["string","number","boolean"];function be(e){return!e||!Object.keys(e).length?[{key:"",value:"",disabled:!1}]:Object.entries(e).map(([a,r])=>{if(!z.includes(typeof r))return{key:a,value:r,disabled:!0};let t=r;return typeof r!="string"&&(t=JSON.stringify(r)),{key:a,value:t,original_key:a}})}function ge(e){const a=e.metadata;if(!a.length||a.length===1&&!a[0].key&&!a[0].value)return null;const t={};return a.forEach(i=>{let o=i.key,s=i.value;const j=i.disabled;if(!(!o||!s)){if(j){t[o]=s;return}if(o=o.trim(),s=s.trim(),s==="true")t[o]=!0;else if(s==="false")t[o]=!1;else{const v=parseFloat(s);isNaN(v)?t[o]=s:t[o]=v}}}),t}function je(e){return e?Object.values(e).some(a=>!z.includes(typeof a)):!1}export{Oe as M};
