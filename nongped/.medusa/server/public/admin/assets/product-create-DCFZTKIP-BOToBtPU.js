import{C as de}from"./chunk-X5VECN6S-BvvQjGj_.js";import{H as Re}from"./chunk-7OYLCEKK-CNDlOgw5.js";import{u as $e,a as Be,b as qe}from"./chunk-VELNOPU6-CR_9aoTe.js";import{r as N,b as T,g as He,h as Le,i as Ke,l as Ge,j as e,m as xe,I as B,a as oe,n as Ue,o as We,v as $,s as L,t as ae,B as M,F as he,D as Xe,H as te,w as l,x as J,y as K,T as G,A as fe,X as ge,z as U,C as Ze,E as Je,G as Qe,J as Ye}from"./index-CJZ0utKv.js";import{C as et}from"./chunk-WDXRULTM-BW2Tdm2u.js";import{u as X}from"./chunk-6CNRNROJ-t0zWnP4-.js";import{C as Z}from"./chunk-BNH57GBH-aOoD9B19.js";import{P as tt,a as st,n as at,U as rt,d as ue}from"./chunk-U4YAYD3Y-D6L4Bivy.js";import{u as ve,a as Q,D as je,S as be,b as ye,c as Ce,C as Ne,s as we,K as _e,P as Se,d as Pe,e as ke}from"./sortable.esm-BpoPRfbd.js";import"./chunk-ZQRKUG6J-DDq2L00Z.js";import{D as A,c as nt,a as it}from"./chunk-TWS5C22H-CR1zo3YM.js";import{C as lt}from"./chunk-OEMJBX6M-BOr3MQp8.js";import{u as ot,D as ct}from"./chunk-W34HOKLZ-C3c-DWJt.js";import"./lodash-r6m_RtXk.js";import"./chunk-VDP2AG2T-lTWCWF6Z.js";import"./chunk-KHOKHZC6-CwL1LPjm.js";import{S as Ie}from"./chunk-JLD5AXG6-DMeKEtHT.js";import{K as dt}from"./chunk-6HTZNHPT-DAtm5oB_.js";import{R as O,u as ze,S as R,a as ut}from"./chunk-KL22UNUW-BusAggzY.js";import{D as ce}from"./dots-six-LZonuE6Q.js";import{P as F}from"./progress-tabs-xF6bypyH.js";import{T as mt}from"./textarea-CySGJxgJ.js";import{T as Ve}from"./thumbnail-badge-DbgOXRqm.js";import{T as pt}from"./trash-Dbmfz9SX.js";import{A as re}from"./alert-B1fSnlBT.js";import{X as De}from"./x-mark-mini-ysYOSGAt.js";import{T as xt}from"./Trans-CyKh6hGN.js";import{C as Y}from"./checkbox-C144Yjdp.js";import{c as ht}from"./index-B1m4_RH3.js";import"./chunk-GA34GXNI-DgFo4cNb.js";import"./chunk-P3UUX2T6-iZ3txzdJ.js";import"./chunk-MSDRGCRR-Cd9PHOgd.js";import"./chunk-ADOCJB6L-BIsWpor0.js";import"./chunk-C76H5USB-BpSyh2up.js";import"./triangles-mini-CxMQ-XTT.js";import"./plus-mini-BdX2C9J6.js";import"./chunk-TYTNUPXB-BP9SNFJJ.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-Ls_FBjZZ.js";import"./index-D2uZCB4l.js";import"./proxy-A1DgzL5D.js";import"./chunk-YEDAFXMB-CRa1E9kp.js";import"./chunk-AOFGTNG6-Do1n8oDW.js";import"./chunk-WX2SMNCD-gsBa7lx4.js";import"./command-bar-DKNd8HCa.js";import"./index-poKGl5ZU.js";import"./chunk-HG5TSG3K-BtN5fyyg.js";import"./format-B_KHsbPT.js";import"./date-picker-Celg6WpL.js";import"./clsx-B-dksMZM.js";import"./popover-Dq5pafWl.js";import"./triangle-left-mini-DJxp3gb4.js";import"./prompt-Di3JszOJ.js";var ft=Object.defineProperty,ee=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable,me=(t,s,a)=>s in t?ft(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,gt=(t,s)=>{for(var a in s||(s={}))Te.call(s,a)&&me(t,a,s[a]);if(ee)for(var a of ee(s))Ee.call(s,a)&&me(t,a,s[a]);return t},vt=(t,s)=>{var a={};for(var r in t)Te.call(t,r)&&s.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&ee)for(var r of ee(t))s.indexOf(r)<0&&Ee.call(t,r)&&(a[r]=t[r]);return a};const Fe=N.forwardRef((t,s)=>{var a=t,{color:r="currentColor"}=a,i=vt(a,["color"]);return N.createElement("svg",gt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},i),N.createElement("path",{stroke:r,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});Fe.displayName="StackPerspective";var jt=({form:t})=>{const{t:s}=T();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(l.Field,{control:t.control,name:"title",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{children:s("products.fields.title.label")}),e.jsx(l.Control,{children:e.jsx(J,{...a,placeholder:"Winter jacket"})})]})}),e.jsx(l.Field,{control:t.control,name:"subtitle",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.subtitle.label")}),e.jsx(l.Control,{children:e.jsx(J,{...a,placeholder:"Warm and cosy"})})]})}),e.jsx(l.Field,{control:t.control,name:"handle",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{tooltip:s("products.fields.handle.tooltip"),optional:!0,children:s("fields.handle")}),e.jsx(l.Control,{children:e.jsx(Re,{...a,placeholder:"winter-jacket"})})]})})]})}),e.jsx(l.Field,{control:t.control,name:"description",render:({field:a})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(l.Control,{children:e.jsx(mt,{...a,placeholder:"A warm and cozy jacket"})})]})})]})},bt={sideEffects:ke({styles:{active:{opacity:"0.4"}}})},yt=({form:t})=>{const{fields:s,append:a,remove:r}=K({name:"media",control:t.control,keyName:"field_id"}),[i,n]=N.useState(null),d=ve(Q(Se),Q(_e,{coordinateGetter:we})),j=g=>{n(g.active.id)},x=g=>{n(null);const{active:w,over:C}=g;if(w.id!==(C==null?void 0:C.id)){const k=s.findIndex(v=>v.field_id===w.id),V=s.findIndex(v=>v.field_id===(C==null?void 0:C.id));t.setValue("media",Pe(s,k,V),{shouldDirty:!0,shouldTouch:!0})}},o=()=>{n(null)},u=g=>()=>{r(g)},m=g=>()=>{const w=s.map((C,k)=>({...C,isThumbnail:k===g}));t.setValue("media",w,{shouldDirty:!0,shouldTouch:!0})},p=g=>({onDelete:u(g),onMakeThumbnail:m(g)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(rt,{form:t,append:a,showHint:!1}),e.jsxs(je,{sensors:d,onDragEnd:x,onDragStart:j,onDragCancel:o,children:[e.jsx(ye,{dropAnimation:bt,children:i?e.jsx(Nt,{field:s.find(g=>g.field_id===i)}):null}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:e.jsx(be,{items:s.map(g=>g.field_id),children:s.map((g,w)=>{const{onDelete:C,onMakeThumbnail:k}=p(w);return e.jsx(Ct,{field:g,onDelete:C,onMakeThumbnail:k},g.field_id)})})})]})]})},Ct=({field:t,onDelete:s,onMakeThumbnail:a})=>{const{t:r}=T(),{attributes:i,listeners:n,setNodeRef:d,setActivatorNodeRef:j,transform:x,transition:o,isDragging:u}=Ce({id:t.field_id}),m={opacity:u?.4:void 0,transform:Ne.Translate.toString(x),transition:o};return t.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",ref:d,style:m,children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(B,{variant:"transparent",type:"button",size:"small",...i,...n,ref:j,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ce,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Me,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(G,{size:"small",leading:"compact",children:t.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(Ve,{}),e.jsx(G,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Oe(t.file.size)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(fe,{groups:[{actions:[{label:r("products.media.makeThumbnail"),icon:e.jsx(Fe,{}),onClick:a}]},{actions:[{icon:e.jsx(pt,{}),label:r("actions.delete"),onClick:s}]}]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",onClick:s,children:e.jsx(ge,{})})]})]}):null},Nt=({field:t})=>{var s,a;return e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(B,{variant:"transparent",size:"small",className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ce,{className:"text-ui-fg-muted"})}),e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Me,{url:t.url})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(G,{size:"small",leading:"compact",children:(s=t.file)==null?void 0:s.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(Ve,{}),e.jsx(G,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:Oe(((a=t.file)==null?void 0:a.size)??0)})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(fe,{groups:[]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",onClick:()=>{},children:e.jsx(ge,{})})]})]})},Me=({url:t})=>t?e.jsx("img",{src:t,alt:"",className:"size-full object-cover object-center"}):null;function Oe(t,s=2){if(t===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,i)).toFixed(s))+" "+r[i]}var wt=({items:t,onChange:s,renderItem:a})=>{const[r,i]=N.useState(null),[n,d]=N.useMemo(()=>{if(r===null)return[null,null];const m=t.findIndex(({id:p})=>p===r.id);return[t[m],m]},[r,t]),j=ve(Q(Se),Q(_e,{coordinateGetter:we})),x=({active:m})=>{i(m)},o=({active:m,over:p})=>{if(p&&m.id!==p.id){const g=t.findIndex(({id:C})=>C===m.id),w=t.findIndex(({id:C})=>C===p.id);s(Pe(t,g,w))}i(null)},u=()=>{i(null)};return e.jsxs(je,{sensors:j,onDragStart:x,onDragEnd:o,onDragCancel:u,children:[e.jsx(St,{children:n&&d!==null?a(n,d):null}),e.jsx(be,{items:t,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:t.map((m,p)=>e.jsx(N.Fragment,{children:a(m,p)},m.id))})})]})},_t={sideEffects:ke({styles:{active:{opacity:"0.4"}}})},St=({children:t})=>e.jsx(ye,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:_t,children:t}),Ae=N.createContext(null),Pt=()=>{const t=N.useContext(Ae);if(!t)throw new Error("useSortableItemContext must be used within a SortableItemContext");return t},kt=({id:t,className:s,children:a})=>{const{attributes:r,isDragging:i,listeners:n,setNodeRef:d,setActivatorNodeRef:j,transform:x,transition:o}=Ce({id:t}),u=N.useMemo(()=>({attributes:r,listeners:n,ref:j,isDragging:i}),[r,n,j,i]),m={opacity:i?.4:void 0,transform:Ne.Translate.toString(x),transition:o};return e.jsx(Ae.Provider,{value:u,children:e.jsx("li",{className:xe("transition-fg flex flex-1 list-none",s),ref:d,style:m,children:a})})},It=()=>{const{attributes:t,listeners:s,ref:a}=Pt();return e.jsx(B,{variant:"transparent",size:"small",...t,...s,ref:a,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(ce,{className:"text-ui-fg-muted"})})},ne=Object.assign(wt,{Item:kt,DragHandle:It}),le=t=>{if(t.length===0)return[];if(t.length===1)return t[0].values.map(r=>({[t[0].title]:r}));const s=t[0],a=t.slice(1);return s.values.flatMap(r=>le(a).map(i=>({[s.title]:r,...i})))},W=t=>Object.values(t).join(" / "),zt=({form:t})=>{var C,k,V;const{t:s}=T(),a=K({control:t.control,name:"options"}),r=K({control:t.control,name:"variants"}),i=$({control:t.control,name:"enable_variants",defaultValue:!1}),n=$({control:t.control,name:"options",defaultValue:[]}),d=$({control:t.control,name:"variants",defaultValue:[]}),j=!!((C=t.formState.errors.options)!=null&&C.length),x=((V=(k=t.formState.errors.variants)==null?void 0:k.root)==null?void 0:V.message)==="invalid_length",o=(v,h)=>{const{isTouched:c}=t.getFieldState("variants"),b=[...n];b[v].values=h;const I=le(b),y=[...d],z=f=>I.find(E=>Object.keys(f).every(P=>f[P]===E[P])),D=y.reduce((f,E)=>{const P=z(E.options);return P&&f.push({...E,title:W(P),options:P}),f},[]),_=new Set(D.map(f=>f.options));I.filter(f=>!_.has(f)).forEach(f=>{D.push({title:W(f),options:f,should_create:!c,variant_rank:D.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),t.setValue("variants",D)},u=v=>{if(v===0)return;a.remove(v);const h=[...n];h.splice(v,1);const c=le(h),b=[...d],I=_=>c.find(S=>Object.keys(_).every(f=>_[f]===S[f])),y=b.reduce((_,S)=>{const f=I(S.options);return f&&_.push({...S,title:W(f),options:f}),_},[]),z=new Set(y.map(_=>_.options));c.filter(_=>!z.has(_)).forEach(_=>{y.push({title:W(_),options:_,should_create:!1,variant_rank:y.length})}),t.setValue("variants",y)},m=v=>{const h=v.map((c,b)=>{const I=d.find(y=>y.title===c.title);return{id:c.id,...I||c,variant_rank:b}});r.replace(h)},p=v=>v.every(h=>h.should_create)?!0:v.some(h=>h.should_create)?"indeterminate":!1,g=v=>{switch(v){case!0:{const h=d.map(c=>({...c,should_create:!0}));t.setValue("variants",h);break}case!1:{const h=d.map(c=>({...c,should_create:!1}));t.setValue("variants",ue(h));break}}},w=()=>{t.setValue("options",[{title:"Default option",values:["Default option value"]}]),t.setValue("variants",ue([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(te,{level:"h2",children:s("products.create.variants.header")}),e.jsx(Ie,{control:t.control,name:"enable_variants",label:s("products.create.variants.subHeadingTitle"),description:s("products.create.variants.subHeadingDescription"),onCheckedChange:v=>{v?(t.setValue("options",[{title:"",values:[]}]),t.setValue("variants",[])):w()}})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(l.Field,{control:t.control,name:"options",render:()=>e.jsx(l.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(l.Label,{children:s("products.create.variants.productOptions.label")}),e.jsx(l.Hint,{children:s("products.create.variants.productOptions.hint")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{a.append({title:"",values:[]})},children:s("actions.add")})]}),j&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:a.fields.map((v,h)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.title`,children:s("fields.title")})}),e.jsx(J,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...t.register(`options.${h}.title`),placeholder:s("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${h}.values`,children:s("fields.values")})}),e.jsx(Ze,{control:t.control,name:`options.${h}.values`,render:({field:{onChange:c,...b}})=>{const I=y=>{o(h,y),c(y)};return e.jsx(lt,{...b,variant:"contrast",onChange:I,placeholder:s("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:h===0,onClick:()=>u(h),children:e.jsx(De,{})})]},v.id))})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(U,{weight:"plus",children:s("products.create.variants.productVariants.label")}),e.jsx(Je,{children:s("products.create.variants.productVariants.hint")})]}),!j&&x&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.variants")}),r.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${n.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(Y,{checked:p(d),onCheckedChange:g})}),e.jsx("div",{}),n.map((v,h)=>e.jsx("div",{children:e.jsx(G,{size:"small",leading:"compact",weight:"plus",children:v.title})},h))]}),e.jsx(ne,{items:r.fields,onChange:m,renderItem:(v,h)=>e.jsx(ne.Item,{id:v.id,className:xe("bg-ui-bg-base border-b",{"border-b-0":h===r.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${n.length}, 1fr)`},children:[e.jsx(l.Field,{control:t.control,name:`variants.${h}.should_create`,render:({field:{value:c,onChange:b,...I}})=>e.jsx(l.Item,{children:e.jsx(l.Control,{children:e.jsx(Y,{...I,checked:c,onCheckedChange:b})})})}),e.jsx(ne.DragHandle,{}),Object.values(v.options).map((c,b)=>e.jsx(G,{size:"small",leading:"compact",children:c},b))]})})})]}):e.jsx(re,{children:s("products.create.variants.productVariants.alert")}),r.fields.length>0&&e.jsx(Qe,{variant:"tip",children:s("products.create.variants.productVariants.tip")})]})})]})]})},Vt=({form:t})=>{const{getFormFields:s}=oe(),a=s("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Dt,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(jt,{form:t}),e.jsx(he,{fields:a,form:t}),e.jsx(yt,{form:t})]}),e.jsx(Xe,{}),e.jsx(zt,{form:t})]})})},Dt=()=>{const{t}=T();return e.jsx("div",{className:"flex flex-col",children:e.jsx(te,{children:t("products.create.header")})})};function Tt({form:t,variant:s,index:a}){const{t:r}=T(),i=K({control:t.control,name:`variants.${a}.inventory`}),n=$({control:t.control,name:`variants.${a}.inventory`}),d=X({queryKey:["inventory_items"],queryFn:x=>L.admin.inventoryItem.list(x),getOptions:x=>x.inventory_items.map(o=>({label:o.title,value:o.id}))}),j=(x,o)=>n==null?void 0:n.some((u,m)=>m!=o&&u.inventory_item_id===x.value);return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(l.Label,{children:s.title}),e.jsx(l.Hint,{children:r("products.create.inventory.label")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{i.append({inventory_item_id:"",required_quantity:""})},children:r("actions.add")})]}),i.fields.map((x,o)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${o}.inventory_item_id`,children:r("fields.item")})}),e.jsx(l.Field,{control:t.control,name:`variants.${a}.inventory.${o}.inventory_item_id`,render:({field:u})=>e.jsx(l.Item,{children:e.jsx(l.Control,{children:e.jsx(Z,{...u,options:d.options.map(m=>({...m,disabled:j(m,o)})),searchValue:d.searchValue,onSearchValueChange:d.onSearchValueChange,fetchNextPage:d.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:r("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${o}.required_quantity`,children:r("fields.quantity")})}),e.jsx(l.Field,{control:t.control,name:`variants.${a}.inventory.${o}.required_quantity`,render:({field:{onChange:u,value:m,...p}})=>e.jsxs(l.Item,{children:[e.jsx(l.Control,{children:e.jsx(J,{type:"number",className:"bg-ui-bg-field-component",min:0,value:m,onChange:g=>{const w=g.target.value;u(w===""?null:Number(w))},...p,placeholder:r("products.create.inventory.quantityPlaceholder")})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx(B,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>i.remove(o),children:e.jsx(De,{})})]},x.id))]})}var Et=({form:t})=>{const{t:s}=T(),a=K({control:t.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(te,{children:s("products.create.inventory.heading")}),a.fields.filter(r=>r.inventory_kit).map((r,i)=>e.jsx(Tt,{form:t,variant:r,index:i},r.id))]})},Ft=({form:t})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx(Et,{form:t})})}),Mt=({form:t})=>{const{t:s}=T(),a=X({queryKey:["product_collections"],queryFn:o=>L.admin.productCollection.list(o),getOptions:o=>o.collections.map(u=>({label:u.title,value:u.id}))}),r=X({queryKey:["product_types"],queryFn:o=>L.admin.productType.list(o),getOptions:o=>o.product_types.map(u=>({label:u.value,value:u.id}))}),i=X({queryKey:["product_tags"],queryFn:o=>L.admin.productTag.list(o),getOptions:o=>o.product_tags.map(u=>({label:u.value,value:u.id}))}),{fields:n,remove:d,replace:j}=K({control:t.control,name:"sales_channels",keyName:"key"}),x=()=>{j([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(te,{children:s("products.organization.header")}),e.jsx(Ie,{control:t.control,name:"discountable",label:s("products.fields.discountable.label"),description:s("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(l.Field,{control:t.control,name:"type_id",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.type.label")}),e.jsx(l.Control,{children:e.jsx(Z,{...o,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})}),e.jsx(l.Field,{control:t.control,name:"collection_id",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.collection.label")}),e.jsx(l.Control,{children:e.jsx(Z,{...o,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(l.Field,{control:t.control,name:"categories",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.categories.label")}),e.jsx(l.Control,{children:e.jsx(et,{...o})}),e.jsx(l.ErrorMessage,{})]})}),e.jsx(l.Field,{control:t.control,name:"tags",render:({field:o})=>e.jsxs(l.Item,{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.tags.label")}),e.jsx(l.Control,{children:e.jsx(Z,{...o,options:i.options,searchValue:i.searchValue,onSearchValueChange:i.onSearchValueChange,fetchNextPage:i.fetchNextPage})}),e.jsx(l.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(l.Field,{control:t.control,name:"sales_channels",render:()=>e.jsxs(l.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(l.Label,{optional:!0,children:s("products.fields.sales_channels.label")}),e.jsx(l.Hint,{children:e.jsx(xt,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx(R.Trigger,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.add")})})]}),e.jsx(l.Control,{className:"mt-0",children:n.length>0&&e.jsx(de,{onClearAll:x,onRemove:d,className:"py-4",children:n.map((o,u)=>e.jsx(de.Chip,{index:u,children:o.name},o.key))})})]})})})]})},H="sc",ie=50,Ot=({form:t})=>{const{t:s}=T(),{getValues:a,setValue:r}=t,{setIsOpen:i,getIsOpen:n}=ut(),[d,j]=N.useState({}),[x,o]=N.useState([]),{searchParams:u,raw:m}=$e({pageSize:ie,prefix:H}),{sales_channels:p,count:g,isLoading:w,isError:C,error:k}=Ye({...u}),V=n(H);N.useEffect(()=>{if(!V)return;const y=a("sales_channels");y&&(o(y.map(z=>({id:z.id,name:z.name}))),j(y.reduce((z,D)=>({...z,[D.id]:!0}),{})))},[V,a]);const v=y=>{const z=typeof y=="function"?y(d):y,D=Object.keys(z),_=new Set(D.filter(f=>z[f]&&!d[f]));let S=[];_.size>0&&(S=(p==null?void 0:p.filter(f=>_.has(f.id)))??[]),o(f=>{const E=f.filter(P=>z[P.id]);return Array.from(new Set([...E,...S]))}),j(z)},h=()=>{r("sales_channels",x,{shouldDirty:!0,shouldTouch:!0}),i(H,!1)},c=Be(),b=Rt(),{table:I}=ot({data:p??[],columns:b,count:(p==null?void 0:p.length)??0,enablePagination:!0,enableRowSelection:!0,getRowId:y=>y.id,pageSize:ie,rowSelection:{state:d,updater:v},prefix:H});if(C)throw k;return e.jsxs(R.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx(R.Header,{}),e.jsx(R.Body,{className:"flex-1 overflow-hidden",children:e.jsx(ct,{table:I,columns:b,pageSize:ie,filters:c,isLoading:w,layout:"fill",orderBy:[{key:"name",label:s("fields.name")},{key:"created_at",label:s("fields.createdAt")},{key:"updated_at",label:s("fields.updatedAt")}],queryObject:m,search:!0,pagination:!0,count:g,prefix:H})}),e.jsx(R.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(R.Close,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.cancel")})}),e.jsx(M,{size:"small",onClick:h,type:"button",children:s("actions.save")})]})})]})},At=ht(),Rt=()=>{const t=qe();return N.useMemo(()=>[At.display({id:"select",header:({table:s})=>e.jsx(Y,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a)}),cell:({row:s})=>e.jsx(Y,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t],[t])},$t=({form:t})=>{const{getFormFields:s}=oe(),a=s("product","create","organize");return e.jsxs(R,{id:H,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Mt,{form:t}),e.jsx(he,{fields:a,form:t})]})}),e.jsx(Ot,{form:t})]})},Bt=({form:t,regions:s,store:a,pricePreferences:r})=>{const{setCloseOnEscape:i}=ze(),n=N.useMemo(()=>{var u;return((u=a==null?void 0:a.supported_currencies)==null?void 0:u.map(m=>m.currency_code))||[]},[a]),d=$({control:t.control,name:"variants",defaultValue:[]}),j=$({control:t.control,name:"options",defaultValue:[]}),x=qt({options:j,currencies:n,regions:s,pricePreferences:r}),o=N.useMemo(()=>{const u=[];return d.forEach((m,p)=>{m.should_create&&u.push({...m,originalIndex:p})}),u},[d]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(A,{columns:x,data:o,state:t,onEditingChange:u=>i(!u)})})},q=it(),qt=({options:t,currencies:s=[],regions:a=[],pricePreferences:r=[]})=>{const{t:i}=T();return N.useMemo(()=>[q.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t.map(n=>n.title).join(" / ")})}),cell:n=>e.jsx(A.ReadonlyCell,{context:n,children:t.map(d=>n.row.original.options[d.title]).join(" / ")}),disableHiding:!0}),q.column({id:"title",name:i("fields.title"),header:i("fields.title"),field:n=>`variants.${n.row.original.originalIndex}.title`,type:"text",cell:n=>e.jsx(A.TextCell,{context:n})}),q.column({id:"sku",name:i("fields.sku"),header:i("fields.sku"),field:n=>`variants.${n.row.original.originalIndex}.sku`,type:"text",cell:n=>e.jsx(A.TextCell,{context:n})}),q.column({id:"manage_inventory",name:i("fields.managedInventory"),header:i("fields.managedInventory"),field:n=>`variants.${n.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:n=>e.jsx(A.BooleanCell,{context:n})}),q.column({id:"allow_backorder",name:i("fields.allowBackorder"),header:i("fields.allowBackorder"),field:n=>`variants.${n.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:n=>e.jsx(A.BooleanCell,{context:n})}),q.column({id:"inventory_kit",name:i("fields.inventoryKit"),header:i("fields.inventoryKit"),field:n=>`variants.${n.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:n=>e.jsx(A.BooleanCell,{context:n,disabled:!n.row.original.manage_inventory})}),...nt({currencies:s,regions:a,pricePreferences:r,getFieldName:(n,d)=>{var j;return(j=n.column.id)!=null&&j.startsWith("currency_prices")?`variants.${n.row.original.originalIndex}.prices.${d}`:`variants.${n.row.original.originalIndex}.prices.${d}`},t:i})],[s,a,t,r,i])},pe="save-draft-button",Ht=({defaultChannel:t,regions:s,store:a,pricePreferences:r})=>{const[i,n]=N.useState("details"),[d,j]=N.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:x}=T(),{handleSuccess:o}=ze(),{getFormConfigs:u}=oe(),m=u("product","create"),p=Ue({defaultValues:{...tt,sales_channels:t?[{id:t.id,name:t.name}]:[]},schema:st,configs:m}),{mutateAsync:g,isPending:w}=We(),C=N.useMemo(()=>s!=null&&s.length?s.reduce((c,b)=>(c[b.id]=b.currency_code,c),{}):{},[s]),k=$({control:p.control,name:"variants"}),V=N.useMemo(()=>k.some(c=>c.manage_inventory&&c.inventory_kit),[k]),v=p.handleSubmit(async(c,b)=>{var _;let I=!1;(b==null?void 0:b.nativeEvent)instanceof SubmitEvent&&(I=((_=b==null?void 0:b.nativeEvent)==null?void 0:_.submitter).dataset.name===pe);const y=c.media||[],z={...c,media:void 0};let D=[];try{if(y.length){const S=y.find(P=>P.isThumbnail),f=y.filter(P=>!P.isThumbnail),E=[];S&&E.push(L.admin.upload.create({files:[S.file]}).then(P=>P.files.map(se=>({...se,isThumbnail:!0})))),f!=null&&f.length&&E.push(L.admin.upload.create({files:f.map(P=>P.file)}).then(P=>P.files.map(se=>({...se,isThumbnail:!1})))),D=(await Promise.all(E)).flat()}}catch(S){S instanceof Error&&ae.error(S.message)}await g(at({...z,media:D,status:I?"draft":"published",regionsCurrencyMap:C}),{onSuccess:S=>{ae.success(x("products.create.successToast",{title:S.product.title})),o(`../${S.product.id}`)},onError:S=>{ae.error(S.message)}})}),h=async c=>{await p.trigger()&&(c==="details"&&n("organize"),c==="organize"&&n("variants"),c==="variants"&&n("inventory"))};return N.useEffect(()=>{const c={...d};i==="details"&&(c.details="in-progress"),i==="organize"&&(c.details="completed",c.organize="in-progress"),i==="variants"&&(c.details="completed",c.organize="completed",c.variants="in-progress"),i==="inventory"&&(c.details="completed",c.organize="completed",c.variants="completed",c.inventory="in-progress"),j({...c})},[i,d]),e.jsx(O.Form,{form:p,children:e.jsxs(dt,{onKeyDown:c=>{if(c.key==="Enter"&&(c.preventDefault(),c.metaKey||c.ctrlKey)){if(i!=="variants"){c.preventDefault(),c.stopPropagation(),h(i);return}v()}},onSubmit:v,className:"flex h-full flex-col",children:[e.jsxs(F,{value:i,onValueChange:async c=>{await p.trigger()&&n(c)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx(O.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(F.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(F.Trigger,{status:d.details,value:"details",className:"max-w-[200px] truncate",children:x("products.create.tabs.details")}),e.jsx(F.Trigger,{status:d.organize,value:"organize",className:"max-w-[200px] truncate",children:x("products.create.tabs.organize")}),e.jsx(F.Trigger,{status:d.variants,value:"variants",className:"max-w-[200px] truncate",children:x("products.create.tabs.variants")}),V&&e.jsx(F.Trigger,{status:d.inventory,value:"inventory",className:"max-w-[200px] truncate",children:x("products.create.tabs.inventory")})]})})}),e.jsxs(O.Body,{className:"size-full overflow-hidden",children:[e.jsx(F.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(Vt,{form:p})}),e.jsx(F.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx($t,{form:p})}),e.jsx(F.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Bt,{form:p,store:a,regions:s,pricePreferences:r})}),V&&e.jsx(F.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(Ft,{form:p})})]})]}),e.jsx(O.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(O.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:x("actions.cancel")})}),e.jsx(M,{"data-name":pe,size:"small",type:"submit",isLoading:w,className:"whitespace-nowrap",children:x("actions.saveAsDraft")}),e.jsx(Lt,{tab:i,next:h,isLoading:w,showInventoryTab:V})]})})]})})},Lt=({tab:t,next:s,isLoading:a,showInventoryTab:r})=>{const{t:i}=T();return t==="variants"&&!r||t==="inventory"&&r?e.jsx(M,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:a,children:i("actions.publish")},"submit-button"):e.jsx(M,{type:"button",variant:"primary",size:"small",onClick:()=>s(t),children:i("actions.continue")},"next-button")},Ks=()=>{const{t}=T(),{store:s,isPending:a,isError:r,error:i}=He({fields:"+default_sales_channel"}),{sales_channel:n,isPending:d,isError:j,error:x}=Le(s==null?void 0:s.default_sales_channel_id,{enabled:!!(s!=null&&s.default_sales_channel_id)}),{regions:o,isPending:u,isError:m,error:p}=Ke({limit:9999}),{price_preferences:g,isPending:w,isError:C,error:k}=Ge({limit:9999}),V=!!s&&!a&&!!o&&!u&&!!n&&!d&&!!g&&!w;if(r)throw i;if(m)throw p;if(j)throw x;if(C)throw k;return e.jsxs(O,{children:[e.jsx(O.Title,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.title")})}),e.jsx(O.Description,{asChild:!0,children:e.jsx("span",{className:"sr-only",children:t("products.create.description")})}),V&&e.jsx(Ht,{defaultChannel:n,store:s,pricePreferences:g,regions:o})]})};export{Ks as Component};
